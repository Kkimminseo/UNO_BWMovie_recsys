<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>AI 채팅</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 500px; margin: auto; }
        #chat-container { border: 1px solid #ddd; padding: 10px; height: 400px; overflow-y: auto; }
        .message { padding: 5px; margin: 5px 0; border-radius: 5px; }
        .user { background: #007bff; color: white; text-align: right; }
        .bot { background: #eee; text-align: left; }
        input { width: 100%; padding: 10px; margin-top: 10px; }
    </style>
</head>
<body>

<h2>AI 채팅</h2>
<div id="chat-container"></div>
<input id="message-input" type="text" placeholder="메시지를 입력하세요..." />

<script>
    const socket = new WebSocket("ws://127.0.0.1:8000/ws/chat/");

    socket.onopen = function () {
        console.log("✅ WebSocket 연결 성공!");
        addMessage("AI", "안녕하세요! 질문을 입력하세요.", "bot");
    };

    socket.onmessage = function (event) {
        const data = JSON.parse(event.data);
        addMessage("AI", data.response, "bot");  // ✅ OpenAI GPT-4o 응답 추가
    };

    document.getElementById("message-input").addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
            const message = e.target.value;
            if (message.trim()) {
                addMessage("나", message, "user");  // ✅ 사용자가 입력한 메시지 표시
                console.log("📤 WebSocket 전송:", message);
                socket.send(JSON.stringify({ message: message }));  // ✅ WebSocket을 통해 서버로 전송
                e.target.value = "";
            }
        }
    });

    function addMessage(sender, text, type) {
        const chatContainer = document.getElementById("chat-container");
        const messageElement = document.createElement("div");
        messageElement.className = "message " + type;
        messageElement.innerText = sender + ": " + text;
        chatContainer.appendChild(messageElement);
        chatContainer.scrollTop = chatContainer.scrollHeight;  // ✅ 자동 스크롤
    }
</script>

</body>
</html>
